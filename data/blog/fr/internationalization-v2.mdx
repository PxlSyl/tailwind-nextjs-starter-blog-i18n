---
title: Internationalisation de la V 2.0
series:
  order: 4
  title: "Blog Starter"
date: '2023-11-17'
lastmod: '2024-06-15'
language: fr
tags: ['next-js', 'tailwind', 'guide', 'fonctionnalites', 'i18n']
authors: ['tailsazimuth']
images: ['/static/images/twitter-card.png']
draft: false
featured: true
summary: Pr√©sentation du Starter Blog Tailwind Next-js v2.0, avec ajout et support de multiples langues.
---

NOTE IMPORTANTE:

Il s'agit toujours d'un WIP (Work In Progress).

J'ai r√©cemment modifi√© toute la logique complexe du serveur pour la pagination et les balises, avec l'utilisation de la biblioth√®que Zustand, et j'ai tout d√©plac√© vers deux composants (pagination et ListLayout).
Bien que ce ne soit pas optimal √† des fins de r√©f√©rencement, l'objectif de ces modifications est de trouver une solution pour g√©rer toutes les URL de mani√®re plus efficace (les URL traduites sont tr√®s mauvaises pour le r√©f√©rencement).
De plus, je ne pense pas que l'impact de ces premiers changements soit vraiment mauvais pour le r√©f√©rencement, car la plupart des utilisateurs utiliseront ce r√©f√©rentiel et ce code pour leur blog de d√©veloppement personnel.

Donc pour l'instant, la logique des pages de blog et des balises est enti√®rement g√©r√©e c√¥t√© client (ce qui se traduit √©galement par une interface utilisateur plus rapide pour les utilisateurs). Cela signifie √©galement un code et des pages c√¥t√© serveur moins complexes.

sitemap.xml et robots.txt sont d√©sormais parfaitement g√©r√©s. J'ai effectu√© toutes les modifications n√©cessaires, la prochaine √©tape consiste √† corriger le flux RSS.

Comment pouvez-VOUS aider? Vous pouvez aider ce projet en faisant des relations publiques. J'ai besoin d'aide pour optimiser les performances sur mobile

## Introduction

Dans cet article, nous discuterons de l'impl√©mentation de i18n et de ce que cela change en comparaison de la version V.2 originale.
Pour une meilleure compr√©hension des fonctionnalit√©s de base, il vous faudra consulter les autres articles, ou la documentation originelle
sur le github de [timlrx](https://github.com/timlrx/tailwind-nextjs-starter-blog)

Vous utilisez le d√©p√¥t? Faites-le-moi savoir et je cr√©erai une liste si vous souhaitez que votre propre blog y soit r√©pertori√©.

Si vous trouvez ce projet utile, veuillez lui attribuer un ‚≠ê pour montrer votre soutien.

## Motivation

Le mod√®le original est incroyable, et tous les cr√©dits majeurs pour celui-ci reviennent √† son cr√©ateur @Timlrx. J'utilisais la V.1 de la version i18n, qui √©tait plut√¥t compliqu√©e √† utiliser et que le cr√©ateur semble avoir malheureusement abandonn√©e. C'est donc ma participation et mon don √† la communaut√© !

De plus, je suis en train de refaire mon propre site web, qui utilise la page du routeur, et une partie du code pour le blog internationalis√© de la V.1.
Je voulais migrer vers l'application router, mais pour cela, j'ai d'abord d√ª apprendre √† internationaliser un site avec l'application router, j'ai donc pris ce d√©p√¥t comme formation.

J'adore l'id√©e d'aider d'autres d√©veloppeurs √† commencer rapidement √† partager leurs pr√©cieuses connaissances avec le monde entier, en am√©liorant Internet, que ce soit dans leur langue maternelle ou en anglais üòå

J'ai √©galement con√ßu un mod√®le beaucoup plus complet pour les artistes, les cr√©ateurs de contenu et les d√©veloppeurs, que j'utilise pour mon propre site et qui est disponible ici :

Version normale :

- [Pablo Pikassiet Next Starter](https://github.com/PxlSyl/pablo-pikassiet-next-starter)

Version I18 :

- [Pablo Pikassiet Next Starter I18n](https://github.com/PxlSyl/pablo-pikassiet-next-starter-i18n)

Mon propre site Web bas√© sur ce nouveau mod√®le :

- [PxlSyl.art](https://www.pxlsyl.art/)

# Changements:

## Nouvelles fonctionnalit√©s

Ce d√©p√¥t sera parfois mis √† jour avec de nouvelles fonctionnalit√©s (non pr√©sentes dans le d√©p√¥t d'origine)
Tout cela peut parfois sembler obsessionnel concernant l'interface et les d√©tails, -peut-√™tre trop soign√© ou un peu surfait- mais j'utilise aussi ce d√©p√¥t comme un espace de jeu et d'apprentissage.

Pour l'instant :
- Nouveau composant "sidetoc" : affiche automatiquement la table des mati√®res de vos articles dans une sidebar d√©di√©e.
- Int√©gration de l'email, du th√®me, ainsi qu'un bouton pour copier rapidement l'URL de la page sur laquelle vous vous trouvez, avec la commande kbar palette.
La motivation pour cela est d'avoir explor√© d'autres biblioth√®ques de palettes de commandes, certaines proposant des √©l√©ments imbriqu√©s pour les 'Actions'. Malheureusement ce n'est pas possible avec kbar, mais cela m'a donn√© de nouvelles id√©es !
- Fonctionnalit√© multi-auteurs pour la section "√† propos" : chaque auteur peut avoir sa propre page √† propos disponible dans un menu d√©roulant sur les grands √©crans, ou affich√©e directement sur les petits √©crans. Si vous souhaitez la d√©sactiver et n'utiliser que la section √† propos "normale", classique, allez sur sitemetadata.js et d√©finissez multiauthors sur false. Dans tous les cas, votre auteur principal doit maintenant avoir le champ "default" d√©fini sur true.
- Section Featured sur la page d'accueil pour les articles que vous souhaitez √©pingler en haut : d√©finissez featured sur true (max deux articles par d√©faut, peut √™tre modifi√© dans le fichier Featured.tsx, dans le dossier component) Le programme choisira les deux derniers articles avec "featured : true". Si aucun article en vedette n'est disponible, cette section ne sera tout simplement pas affich√©e !
- Chaque tag a maintenant sa propre pagination ! Si le nombre d'articles est sup√©rieur √† celui que vous avez d√©fini (par d√©faut, d√©fini sur 5) alors une nouvelle page est automatiquement cr√©√©e pour les articles suivants incluant le m√™me tag.
- Le syst√®me de commentaires Waline est maintenant pris en charge ! C'est probablement le meilleur syst√®me de commentaires open source du moment, avec m√™me i18n et de nombreuses autres fonctionnalit√©s int√©ressantes ! Tout d'abord, suivez [le tutoriel officiel](https://waline.js.org/en/guide/get-started/) pour configurer la base de donn√©es de commentaires et votre serveur vercel. Il existe de nombreuses options disponibles, alors prenez le temps de lire leur documentation. Comme il est bas√© sur Vue, il est toujours compatible avec Next.js, et j'ai cr√©√© un nouveau composant de commentaire. Vous le trouverez dans le dossier "walinecomponents". J'ai √©galement ajout√© un nouveau fichier css, et vous pouvez modifier le style ici si n√©cessaire. Une fois que vous avez d√©ploy√© votre application pour les commentaires, modifiez le fichier sitemetadata.js. D√©finissez la propri√©t√© "iscomments" sur false, d√©finissez "iswaline"
sur true et d√©finissez l'URL de votre serveur de commentaires en cons√©quence dans "walineServer". Si votre langue n'est pas prise en charge par waline, faites une demande de publication sur leur r√©f√©rentiel ou demandez-leur gentiment d'ajouter votre propre traduction (fournissez-la vous-m√™me au pr√©alable). C'est ce que j'ai fait pour soutenir le fran√ßais, et c'est ainsi que nous travaillons dans le monde open source¬†!

- Les s√©ries pour vos articles sont d√©sormais prises en charge, consultez la d√©mo d√©ploy√©e!


Exemple d'int√©gration de cette nouvelle fonctionnalit√©: 

```mdx
title: Internationalization of V 2.0
series:
  order: 4 // Vous devez ajouter un num√©ro pour l'ordre r√©el de votre publication dans votre s√©rie d'articles.
  title: "Blog Starter" // Vous devez ajouter le m√™me titre √† tous vos articles de la m√™me s√©rie
date: '2023-11-17'
lastmod: '2023-11-17'
language: en
tags: ['next-js', 'tailwind', 'guide', 'features', 'i18n']
authors: ['default']
images: ['/static/images/twitter-card.png']
draft: false
summary: Presentation of the Starter Blog Tailwind Next-js v2.0, with addition and support for multiple languages.
```

- Composant de partage : vous ou vos utilisateurs pouvez partager vos articles de blog sur Facebook, Twitter, Linkedin, WhatsApp, Threads ou Telegram en toute simplicit√© ! Que serait un blog moderne de 2024 sans cette possibilit√© ?

- Transitions de page fluides gr√¢ce √† [Framer Motion](https://github.com/framer/motion) (consultez le fichier template.tsx dans le dossier app et jetez un ≈ìil √† la documentation next.js suivante
pour la fonctionnalit√© de fichier [template](https://nextjs.org/docs/app/api-reference/file-conventions/template))
Remarque : il s'agit d'une impl√©mentation basique mais efficace. Je vous encourage vivement √† exp√©rimenter framer-motion et son utilisation au sein du nouveau
routeur. J'ai √©galement ajout√© un peu de Framer Motion √† la fen√™tre de contact de formspree et au composant ListLayoutWithTags.tsx

- Nouveau composant MDX : excellent lecteur audio pour les fichiers mdx (au cas o√π vous feriez des podcasts, ou m√™me de la musique), gr√¢ce √† [react-h5-audio-player](https://github.com/lhz516/react-h5-audio-player)

- Indicateur de taille d'√©cran Tailwind : une petite aide pour le mode d√©veloppement et le responsive design (voir TwSizeIndicator.tsx dans /components/helper)

- [Formspree](https://formspree.io/) prise en charge de l'ic√¥ne mail, avec une belle bo√Æte de dialogue modale. Formspree permet √† vos utilisateurs de vous contacter et de vous envoyer des messages directement depuis votre site, avec une protection anti-spam. Cr√©ez simplement un compte de base gratuit, lisez la documentation et r√©cup√©rez la cl√© de votre compte formspree, puis remplacez la cl√© par la v√¥tre ici, dans components/formspree/index.tsx :

```ts:formspree/useContactForm.ts
/* Ligne 11*/
 const [state, handleSubmit, reset] = useForm('xdojkndq')
```

NOTE IMPORTANTE¬†: vous devez remplacer la cl√© dans useform comme ceci¬†: useform('[votre cl√©]'). La cl√© fournie est
une cl√© de test que j'ai fournie. Vous pouvez l'utiliser pour v√©rifier si la bo√Æte toast est fonctionnelle par exemple, mais sachez
que je recevrai tous vos messages de test. (Vous pouvez toujours m'envoyer un message de bienvenue amical¬†!)

Si vous ne souhaitez pas utiliser Formspree, acc√©dez au fichier siteMetadata.js et d√©finissez formspree sur "false".

## Librairies

Pour les traductions, la biblioth√®que choisie n'est pas next-translate comme dans la V.1 de GautierArcin, mais les biblioth√®ques suivantes :

- i18next
- i18next-browser-languagedetector
- i18next-resources-to-backend
- React-i18next

En effet, avec la nouvelle version de next-js et l'app router, il m'a √©t√© plus facile de trouver des informations et des tutoriels pour que tout fonctionne comme pr√©vu. (J'ai d'abord essay√© avec next-translate, mais il y a trop de probl√®mes non r√©solus actuellement avec cette biblioth√®que et les fonctionnalit√©s li√©es au nouveau router)

## Configuration

Au sein du dossier app, tout le contenu a √©t√© d√©pla√ß√© vers un nouveau dossier [locale]" : ceci est la mani√®re officielle recommand√©e par next.js. A √©galement √©t√© ajout√© un dossier i18n:

```
app
  ‚îÇ
 [locale]
    ‚îÇ
    ‚îú‚îÄ‚îÄ i18n
    ‚îÇ     ‚îÇ
    ‚îÇ     ‚îú‚îÄ‚îÄlocales
    ‚îÇ     ‚îÇ     ‚îÇ
    ‚îÇ     ‚îÇ     ‚îú‚îÄ‚îÄ en
    ‚îÇ     ‚îÇ     ‚îÇ   ‚îú‚îÄ‚îÄ about.json
    ‚îÇ     ‚îÇ     ‚îÇ   ‚îÇ   
    ‚îÇ     ‚îÇ     ‚îÇ   ‚îú‚îÄ‚îÄ home.json
    ‚îÇ     ‚îÇ     ‚îÇ   ‚îÇ  
    ‚îÇ     ‚îÇ     ‚îÇ   ‚îî‚îÄ‚îÄ ...
    ‚îÇ     ‚îÇ     ‚îî‚îÄ‚îÄ fr
    ‚îÇ     ‚îÇ         ‚îú‚îÄ‚îÄ about.json
    ‚îÇ     ‚îÇ         ‚îÇ   
    ‚îÇ     ‚îÇ         ‚îú‚îÄ‚îÄ home.json
    ‚îÇ     ‚îÇ         ‚îÇ 
    ‚îÇ     ‚îÇ         ‚îî‚îÄ‚îÄ ...
    ‚îÇ     ‚îÇ  
    ‚îÇ     ‚îÇ
    ‚îÇ     ‚îú‚îÄ‚îÄ client.ts
    ‚îÇ     ‚îú‚îÄ‚îÄ locales.js
    ‚îÇ     ‚îú‚îÄ‚îÄ server.ts
    ‚îÇ     ‚îî‚îÄ‚îÄ settings.ts
    ‚îÇ
    ‚îî‚îÄ‚îÄ ...
```

C'est donc dans ce dossier i18n que se situe la logique principale pour l'internationalisation de l'application.

- Fichiers json :

Le sous-dossier "locales" contient les fichiers .json o√π vous d√©finirez vos traductions, la convention √©tant de d√©finir un fichier par page de votre site, avec le nom de la page concern√©e pour le nom du fichier json.
Il y a √©galement un fichier "common" : si vous ne sp√©cifiez pas de "namespace" ou ns (le nom du fichier sans l'extension json) dans vos pages ou composants, les traductions seront pioch√©es dans ce fichier par d√©faut.

*Important : pour chaque langue, il doit y avoir un fichier correspondant avec le m√™me nom, par exemple un fichier "about" pour "fr" et pour "en", etc. Ainsi que des clefs de traduction avec le m√™me nom au sein
de chaque fichier. 

Exemple : 

En anglais dans le dossier "en":

```json:projects.json
{
  "title": "Projects",
  "description": "Showcase your projects with a hero image (16 x 9)",
  "learn": "Learn more",
  "subtitle": "Here you will find information about my current projects",
  "linkto": "Link to"
}
```

En fran√ßais dans le dossier "fr":

```json:projects.json
{
  "title": "Projets",
  "description": "Pr√©sentez vos projets avec une image (16 x 9)",
  "learn": "En savoir plus",
  "subtitle": "Ici vous trouverez des informations sur mes projets actuels.",
  "linkto": "Lien vers"
}
```

- locales.js :

Il s'agit du fichier o√π vous d√©finirez les langues que vous souhaitez utiliser, ainsi que la langue par d√©faut: 

```js:locales.js
const fallbackLng = 'en' // langue par d√©faut
const secondLng = 'fr' 

module.exports = { fallbackLng, secondLng }
```

Vous pouvez ajouter autant de langues que souhait√©: 

```js:locales.js
/* Exemple d'ajout d'une 3√®me langue :*/
const fallbackLng = 'en'
const secondLng = 'fr'
const thirdLng = 'es'

module.exports = { fallbackLng, secondLng, thirdLng }
```

Toutefois, cela n√©cessitera quelques √©tapes de configuration suppl√©mentaires au sein d'autres fichiers (principalement des fichiers qui sont discut√©s dans cet article)

Vous pouvez √©galement intervertir la langue par d√©faut et la seconde langue : 

```js:locales.js
/* Exemple de modification de langue par d√©faut:*/
const fallbackLng = 'fr'
const secondLng = 'en'

module.exports = { fallbackLng, secondLng}
```

- settings.ts

Il s'agit d'un fichier de configuration, qui permet de d√©finir un objet locales ainsi que les options correspondantes :

```ts:settings.ts
import type { InitOptions } from 'i18next'
import { fallbackLng, secondLng } from './locales'

/* Objet locales, qui d√©finit toutes les langues qui seront utilis√©es dans l'application: */
export const locales = [fallbackLng, secondLng] as const
/* D√©finition typescript de type pour nos locales :*/
export type LocaleTypes = (typeof locales)[number]
/* "Namespace" (ou ns) par d√©faut : les traductions seront pioch√©es dans le fichier 
common.json si aucun ns n'est sp√©cifi√© dans vos composants ou pages: */
export const defaultNS = 'common' 
/* Fonction qui sera r√©utilis√©e dans les fichiers client.ts et server.ts: */
export function getOptions(locale = fallbackLng, ns = defaultNS): InitOptions {
  return {
    debug: true,
    supportedLngs: locales,
    fallbackLng,
    lng: locale,
    fallbackNS: defaultNS,
    defaultNS,
    ns,
  }
}
```

- client.ts et server.ts :

Sans rentrer dans des d√©tails complexes, ces deux fichiers exportent chacun
une fonction pour la traduction (useTranslation c√¥t√© client, createTranslation c√¥t√© serveur), 
r√©utilisables dans vos pages et composants :

```ts:client.ts
export function useTranslation(lng: LocaleTypes, ns: string) {
  const translator = useTransAlias(ns)
  const { i18n } = translator

  /* Ex√©cut√© lorsque le contenu est rendu c√¥t√© serveur: */
  if (runsOnServerSide && lng && i18n.resolvedLanguage !== lng) {
    i18n.changeLanguage(lng)
  } else {
    /* Utiliser notre impl√©mentation personnalis√©e lors de l'ex√©cution c√¥t√© client: */
    // eslint-disable-next-line react-hooks/rules-of-hooks
    useCustomTranslationImplem(i18n, lng)
  }
  return translator
}
```

```ts:server.ts
export async function createTranslation(lang: LocaleTypes, ns: string) {
  const i18nextInstance = await initI18next(lang, ns)

  return {
    /* La fonction de traduction "t" que nous utiliserons dans nos composants: */
    // e.g. t('greeting')
    t: i18nextInstance.getFixedT(lang, Array.isArray(ns) ? ns[0] : ns),
  }
}
```

Exemple de composant c√¥t√© client, avec traduction de l'aria-label du bouton :

```ts:ThemeSwitch.tsx
'use client'

import { useEffect, useState } from 'react'
import { useTheme } from 'next-themes'
/*Importation du hook fourni par next.js pour r√©cup√©rer la langue
d√©finie par l'utilisateur, et de la fonction de traduction c√¥t√© client: */
import { useParams } from 'next/navigation'
import { LocaleTypes } from 'app/[locale]/i18n/settings'
import { useTranslation } from 'app/[locale]/i18n/client'

const ThemeSwitch = () => {
  /* Utilisation du hook fourni par next.js pour r√©cup√©rer la langue actuellement d√©finie: */ 
  const locale = useParams()?.locale as LocaleTypes
  /* Utilisation de la fonction de traduction c√¥t√© client:
   pas de namespace (ns) d√©fini (crochets vide), par cons√©quent la traduction sera pioch√©e 
   dans le fichier common.json */
  const { t } = useTranslation(locale, '')
  const [mounted, setMounted] = useState(false)
  const { theme, setTheme, resolvedTheme } = useTheme()

  useEffect(() => setMounted(true), [])

  if (!mounted) {
    return null
  }

  return (
    <button
    /* Traduction de l'aria-label */
      aria-label={t('darkmode')}
      onClick={() => setTheme(theme === 'dark' || resolvedTheme === 'dark' ? 'light' : 'dark')}
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 20 20"
        fill="currentColor"
        className="h-6 w-6 text-gray-900 dark:text-gray-100"
      >
        {mounted && (theme === 'dark' || resolvedTheme === 'dark') ? (
          <path
            fillRule="evenodd"
            d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
            clipRule="evenodd"
          />
        ) : (
          <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
        )}
      </svg>
    </button>
  )
}

export default ThemeSwitch
```

Exemple de composant c√¥t√© serveur :

```ts:footer.tsx
import Link from './Link'
import siteMetadata from '@/data/siteMetadata'
import SocialIcon from '@/components/social-icons'
/*Importation de la fonction de traduction c√¥t√© serveur: */
import { createTranslation } from 'app/[locale]/i18n/server'
import { LocaleTypes } from 'app/[locale]/i18n/settings'

type Props = {
  params: { locale: LocaleTypes }
}
/* la langue actuelle est pass√©e en tant que prop des param√®tres de la page: */
export default async function Footer({ params: { locale } }: Props) {
/* Utilisation de la fonction de traduction c√¥t√© serveur, avec le namespace "footer" */
  const { t } = await createTranslation(locale, 'footer')
  return (
    <footer>
      <div className="mt-16 flex flex-col items-center">
        <div className="mb-3 flex space-x-4">
          <SocialIcon kind="mail" href={`mailto:${siteMetadata.email}`} size={6} />
          <SocialIcon kind="github" href={siteMetadata.github} size={6} />
          <SocialIcon kind="facebook" href={siteMetadata.facebook} size={6} />
          <SocialIcon kind="youtube" href={siteMetadata.youtube} size={6} />
          <SocialIcon kind="linkedin" href={siteMetadata.linkedin} size={6} />
          <SocialIcon kind="twitter" href={siteMetadata.twitter} size={6} />
        </div>
        <div className="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400">
          <div>{siteMetadata.author}</div>
          <div>{` ‚Ä¢ `}</div>
          <div>{`¬© ${new Date().getFullYear()}`}</div>
          <div>{` ‚Ä¢ `}</div>
          <Link href="/">{siteMetadata.title}</Link>
        </div>
        <div className="mb-8 text-sm text-gray-500 dark:text-gray-400">
          <Link href="https://github.com/timlrx/tailwind-nextjs-starter-blog">      
       {t('theme')}
          </Link>
        </div>
      </div>
    </footer>
  )
}
```

Pour la cr√©ation de nouveaux composants ou pages, vous devrez donc vous appuyer sur ces deux 
fonctions concernant vos traductions, selon que le composant soit rendu c√¥t√© client, ou c√¥t√© serveur.

- Middleware.ts :

I18n n'√©tant pas support√© nativement au sein du nouveau router, il s'agit d'un fichier essentiel au bon 
fonctionnement de l'ensemble. Il est √©galement essentiel d'utiliser le "matcher" 
(ici avec des valeurs invers√©es qui permettent d'exclure les dossiers et fichiers qui ne doivent pas
√™tre pris en charge par le middleware)

```ts:middleware.ts
import { NextResponse, NextRequest } from 'next/server'
import { locales } from 'app/[locale]/i18n/settings'
import { fallbackLng } from 'app/[locale]/i18n/locales'

export function middleware(request: NextRequest) {
  /* V√©rifier si une langue est prise en charge dans le nom de chemin: */
  const pathname = request.nextUrl.pathname

  /* V√©rifier si la langue par d√©faut est dans le nom de chemin: */
  if (pathname.startsWith(`/${fallbackLng}/`) || pathname === `/${fallbackLng}`) {
    /* ex: la requ√™te entrante est: /en/about
    Le nouveau nom de chemin est maintenant: /about */
    return NextResponse.redirect(
      new URL(
        pathname.replace(`/${fallbackLng}`, pathname === `/${fallbackLng}` ? '/' : ''),
        request.url
      )
    )
  }

  const pathnameIsMissingLocale = locales.every(
    (locale) => !pathname.startsWith(`/${locale}/`) && pathname !== `/${locale}`
  )

  if (pathnameIsMissingLocale) {
    /* Nous sommes sur la langue par d√©faut
    R√©ecriture pour que next.js comprenne */

    // ex: la requ√™te entrante est: /about 
    // Informer Next.js qu'il devrait se comporter comme si c'√©tait: /en/about
    return NextResponse.rewrite(new URL(`/${fallbackLng}${pathname}`, request.url))
  }
}

export const config = {
  /* Ne pas executer le middleware sur les chemins suivants: */
  // prettier-ignore
  matcher:
  '/((?!api|static|data|css|scripts|.*\\..*|_next).*|sitemap.xml)',
}
```

## Articles

Tous les articles sont regroup√©s au sein du dossier "data/blog"

Ils sont organis√©s en sous-dossiers : ¬´ data/blog/en ¬ª pour l'anglais, et ¬´ data/blog/fr ¬ª pour le fran√ßais.
Vous pouvez nommer les sous-dossiers pour vos langues comme vous le souhaitez : avec la configuration actuelle dans le fichier contentlayer.config.ts, le slug de vos articles est le nom de fichier de votre article, sans l'extension .mdx. Tous vos articles traduits doivent avoir le m√™me nom que les originaux, pour des raisons de gestion de la traduction.

Exemple :

En : ¬´ data/blog/en/code-sample.mdx ¬ª
Fr : ¬´ data/blog/fr/code-sample.mdx ¬ª

Etc.

- En-t√™tes de vos articles :

```mdx:article.mdx
---
title: titre de l'article
date: date de cr√©ation
lastmod: derni√®re date de modification
language: langue de l'article
tags: balises
authors: auteurs
images: images
draft: en construction ou non
summary: r√©sum√©
---
```

- contentlayer.config.ts :

Au sein du fichier "contentlayer.config.ts" il y a donc des changements mineurs d√ªs √†
l'internationalisation : 

```
export const Blog = defineDocumentType(() => ({
  name: 'Blog',
  filePathPattern: 'blog/**/*.mdx',
  contentType: 'mdx',
  fields: {
    title: { type: 'string', required: true },
    series: { type: 'nested', of: Series },
    date: { type: 'date', required: true },
    language: { type: 'string', required: true }, // Nouveau champs obligatoire
    tags: { type: 'list', of: { type: 'string' }, default: [] },
    lastmod: { type: 'date' },
    draft: { type: 'boolean' },
    summary: { type: 'string' },
    images: { type: 'json' },
    authors: { type: 'list', of: { type: 'string' }, required: true },
    layout: { type: 'string' },
    bibliography: { type: 'string' },
    canonicalUrl: { type: 'string' },
  },
  ...
)})
```

Pour le champs "auteurs" :

```
export const Authors = defineDocumentType(() => ({
  name: 'Authors',
  filePathPattern: 'authors/**/*.mdx',
  contentType: 'mdx',
  fields: {
    name: { type: 'string', required: true },
    language: { type: 'string', required: true }, // Nouveau champs obligatoire
    default: {type: 'boolean'},
    avatar: { type: 'string' },
    occupation: { type: 'string' },
    company: { type: 'string' },
    email: { type: 'string' },
    twitter: { type: 'string' },
    linkedin: { type: 'string' },
    github: { type: 'string' },
    layout: { type: 'string' },
  },
```

-G√©n√©ration des tags : 

L√† aussi, il a √©t√© n√©cessaire de faire des modifications, afin de g√©n√©rer un objet .json
avec des tags pour chaque langue.

```
function createTagCount(allBlogs) {
  const tagCount = {
    [fallbackLng]: {},
    [secondLng]: {},
  }

  allBlogs.forEach((file) => {
    if (file.tags && (!isProduction || file.draft !== true)) {
      file.tags.forEach((tag: string) => {
        const formattedTag = GithubSlugger.slug(tag)
        if (file.language === fallbackLng) { // tags pour la langue par d√©faut
          tagCount[fallbackLng][formattedTag] = (tagCount[fallbackLng][formattedTag] || 0) + 1
        } else if (file.language === secondLng) {  // tags pour la seconde langue
          tagCount[secondLng][formattedTag] = (tagCount[secondLng][formattedTag] || 0) + 1
        }
      })
    }
  })

  writeFileSync('./app/[locale]/tag-data.json', JSON.stringify(tagCount))
}
```

Note : si vous souhaitez ajouter d'autres langues (3, 4 ou m√™me 5 langues), il vous faudra modifier la logique pour prendre en charge 
ces nouvelles langues.

## Auteurs

Les dossiers contenant les auteurs sont organis√©s par langue, et les informations sur les auteurs peuvent √™tre traduites.

L'impl√©mentation est assez simple et directe : si vous voulez modifier ou ajouter une langue, modifiez ou ajoutez simplement
les dossiers avec vos traductions correspondantes pour les nouvelles langues.

## Fichier siteMetadata et nouveau fichier localeMetadata

Le fichier siteMetadata.js pr√©sent dans le dossier "/data" ne n√©cessite pas de modifications li√©es √† l'internationalisation.

Par contre, afin de g√©rer au mieux les m√©tadonn√©es, il a fallu cr√©er un nouveau fichier, pour le titre
et la description :

```ts:localeMetadata.ts
type Metadata = {
  [locale: string]: string
}
/* Ajoutez ou modifiez le titre ici selon les langues choisies: */
export const maintitle: Metadata = {
  en: 'Next.js i18n Starter Blog',
  fr: 'Starter Blog Next.js i18n',
}
/* Ajoutez ou modifiez la description ici selon les langues choisies: */
export const maindescription: Metadata = {
  en: 'A blog created with Next.js, i18n and Tailwind.css',
  fr: 'Un blog cr√©e avec tailwind, i18n et next.js',
}
```

## Onglet "Projets"

La logique n√©cessaire √† l'onglet "projets" r√©side dans le fichier suivant, √©galement pr√©sent dans le dossier"/data" :

```ts:projectsData.ts
type Project = {
  title: string
  description: string
  imgSrc: string
  href: string
}

type ProjectsData = {
  [locale: string]: Project[]
}

const projectsData: ProjectsData = {
  en: [
    {
      title: 'A Search Engine',
      description: `What if you could look up any information in the world? Webpages, images, videos
        and more. Google has many features to help you find exactly what you're looking
        for.`,
      imgSrc: '/static/images/google.png',
      href: 'https://www.google.com',
    },
    {
      title: 'The Time Machine',
      description: `Imagine being able to travel back in time or to the future. Simple turn the knob
        to the desired date and press "Go". No more worrying about lost keys or
        forgotten headphones with this simple yet affordable solution.`,
      imgSrc: '/static/images/time-machine.jpg',
      href: '/blog/the-time-machine',
    },
  ],

  fr: [
    {
      title: 'Un moteur de recherche',
      description: `Et si vous pouviez rechercher n'importe quelle information dans le monde ? Pages Web, images, vid√©os
        et plus. Google propose de nombreuses fonctionnalit√©s pour vous aider √† trouver exactement ce que vous cherchez.`,
      imgSrc: '/static/images/google.png',
      href: 'https://www.google.com',
    },
    {
      title: 'La Machine √† remonter le temps',
      description: `Imaginez pouvoir voyager dans le temps ou vers le futur. Tournez simplement le bouton
        √† la date souhait√©e et appuyez sur "Go". Ne vous inqui√©tez plus des cl√©s perdues ou
        √©couteurs oubli√©s avec cette solution simple mais abordable.`,
      imgSrc: '/static/images/time-machine.jpg',
      href: '/blog/the-time-machine',
    },
  ],
}

export default projectsData
```

Encore une fois, modifiez simplement la logique en conservant la m√™me structure g√©n√©rale, et selon vos langues choisies/et/ou
nombre de langues.

## Barre de recherche :

Le d√©p√¥t original permets le support de kbar et d'algolia.

Ici, la barre de recherche repose sur la librairie kbar, et le support d'Algolia n'est pas pr√©vu.
Si vous pr√©ferez utiliser Algolia, ce sera donc √† vous de l'impl√©menter sur votre site, √† la place de kbar.

Il y a un probl√®me lors de l'utilisation de traductions standard, j'ai donc mis en place une solution de contournement pour ce probl√®me. Modifiez simplement le nom de chaque √©l√©ment de menu, ainsi que l'objet navigationSection, en fonction des langues que vous utilisez.

```ts:SearchProvider.ts
  export const SearchProvider = ({ children }: SearchProviderProps) => {
  const locale = useParams()?.locale as LocaleTypes
  const { t } = useTranslation(locale, '')
  const router = useRouter()
   const authors = allAuthors
    .filter((a) => a.language === locale)
    .sort((a, b) => (a.default === b.default ? 0 : a.default ? -1 : 1)) as Authors[]

  const authorSearchItems = authors.map((author) => {
    const { name, slug } = author
    return {
      id: slug,
      name: name,
      keywords: '',
      shortcut: [],
      section: locale === fallbackLng ? 'Authors' : 'Auteurs',
      perform: () => router.push(`/${locale}/about/${slug}`),
      icon: (
        <i>
          <AboutIcon />
        </i>
      ),
    }
  })

  const showAuthorsSearch = siteMetadata.multiauthors
  const authorsActions = [
    ...(showAuthorsSearch ? authorSearchItems : []),
    ...(showAuthorsSearch
      ? []
      : [
          {
            id: 'about',
            name: locale === fallbackLng ? 'About' : '√Ä propos',
            keywords: '',
            shortcut: ['a'],
            section: locale === fallbackLng ? 'Navigate' : 'Naviguer',
            perform: () => router.push(`/${locale}/about`),
            icon: (
              <i>
                <AboutIcon />
              </i>
            ),
          },
        ]),
  ]
  /* probl√®me lors de l'utilisation de traductions r√©guli√®res, il s'agit d'une solution de contournement pour montrer comment impl√©menter les titres de section */
   /*Modifiez la ligne suivante en fonction de vos langues impl√©ment√©es¬†: */
  const navigationSection = locale === fallbackLng ? 'Navigate' : 'Naviguer'
  return (
    <KBarSearchProvider
      kbarConfig={{
        searchDocumentsPath: 'search.json',
        /*probl√®me lors de l'utilisation de traductions r√©guli√®res, il s'agit d'une solution de contournement pour montrer comment impl√©menter les titres de menu traduits */
        defaultActions: [
          {
            id: 'home',
            name: locale === fallbackLng ? 'Home' : 'Accueil',
            keywords: '',
            shortcut: ['h'],
            section: navigationSection,
            perform: () => router.push(`/${locale}`),
            icon: (
              <i>
                <HomeIcon />
              </i>
            ),
          },
          {
            id: 'blog',
            name: locale === fallbackLng ? 'Blog' : 'Blog',
            keywords: '',
            shortcut: ['b'],
            section: navigationSection,
            perform: () => router.push(`/${locale}/blog`),
            icon: (
              <i>
                <BlogIcon />
              </i>
            ),
          },
          {
            id: 'tags',
            name: locale === fallbackLng ? 'Tags' : 'Tags',
            keywords: '',
            shortcut: ['t'],
            section: navigationSection,
            perform: () => router.push(`/${locale}/tags`),
            icon: (
              <i>
                <TagsIcon />
              </i>
            ),
          },
          {
            id: 'projects',
            name: locale === fallbackLng ? 'Projects' : 'Projets',
            keywords: '',
            shortcut: ['p'],
            section: navigationSection,
            perform: () => router.push(`/${locale}/projects`),
            icon: (
              <i>
                <ProjectsIcon />
              </i>
            ),
          },
          ...authorsActions,
        ],
        onSearchDocumentsLoad(json) {
          return json
            .filter((post: CoreContent<Blog>) => post.language === locale)
            .map((post: CoreContent<Blog>) => ({
              id: post.path,
              name: post.title,
              keywords: post?.summary || '',
              section: t('content'),
              subtitle: post.tags.join(', '),
              perform: () => router.push(`/${locale}/blog/${post.slug}`),
            }))
        },
      }}
    >
      {children}
    </KBarSearchProvider>
  )
}
```

## Choses √† faire :

- Corriger la traduction dans la page 404. Ceci est li√© au fonctionnement actuel de la fonction not-found,
il faut donc attendre un correctif du c√¥t√© de next-js voir ici : [i18n pour la page not-found](https://github.com/vercel/next.js/discussions/50518)

- Corriger rss.mjs. Si vous trouvez une solution de votre c√¥t√©, n'h√©sitez pas √† ouvrir un PR !

Tout le reste fonctionne actuellement comme pr√©vu.

Voici une autre solution possible pour l'int√©gration i18n concernant le SEO, et m√™me l'URL traduite :

- [next-roots](https://github.com/svobik7/next-roots)

Toute aide pour des am√©liorations et/ou des rapports de bugs est la bienvenue !

Notes importantes :

- J'utilise un composant Link personnalis√© pour la s√©lection de la langue : je pr√©f√®re cela √† l'√©l√©ment de s√©lection HTML (plus facile √† personnaliser).
Le petit inconv√©nient est qu'il n√©cessite plus de code. Si vous pr√©f√©rez, vous √™tes libre d'adapter et d'utiliser l'√©l√©ment select √† la place, mais je
Je le garderai tel quel pour le mod√®le.

- Ne mettez pas √† jour les d√©pendances : cela cassera votre application car certaines choses doivent √™tre corrig√©es du c√¥t√© de ces biblioth√®ques
‚Äã
Auteur : [pxlsyl](https://pxlsyl.art)