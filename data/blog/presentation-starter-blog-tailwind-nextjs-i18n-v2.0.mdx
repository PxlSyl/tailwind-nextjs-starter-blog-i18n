---
title: Présentation du Starter Blog Tailwind Next-js V 2.0 avec i18n
date: '2023-11-17'
lastmod: '2023-11-17'
language: fr
tags: ['next-js', 'tailwind', 'guide', 'fonctionnalites', 'i18n']
authors: ['default']
images: ['/static/images/twitter-card.png']
draft: true
summary: Présentation du Starter Blog Tailwind Next-js v2.0, avec ajout et support de multiples langues.
---

## Introduction

Dans cet article, nous discuterons de l'implémentation de i18n et de ce que cela change en comparaison de la version V.2 originale.
Pour une meilleure compréhension des fonctionnalités de base, il vous faudra consulter les autres articles, ou la documentation originelle
sur le github de [timlrx](https://github.com/timlrx/tailwind-nextjs-starter-blog)

# Changements:

## Librairies

Pour les traductions, la bibliothèque choisie n'est pas next-translate comme dans l'alternative V.1 de GautierArcin, mais les bibliothèques suivantes :

- i18next
- i18next-browser-languagedetector
- i18next-resources-to-backend

En effet, avec la nouvelle version de next-js et l'app router, il m'a été plus facile de trouver des informations et des tutoriels pour que tout fonctionne comme prévu. (J'ai d'abord essayé avec next-translate, mais il y a trop de problèmes non résolus actuellement avec cette bibliothèque et les nouvelles fonctionnalités liées à l'app router)

## Configuration

Au sein du dossier app, tout le contenu a été déplaçé vers un nouveau dossier [locale] : ceci est la manière officielle recommandée par next.js. A également été ajouté un dossier i18n:

```
app
  │
 [locale]
    │
    ├── i18n
    │     │
    │     ├──locales
    │     │     │
    │     │     ├── en
    │     │     │   ├── about.json
    │     │     │   │   
    │     │     │   ├── home.json
    │     │     │   │  
    │     │     │   └── ...
    │     │     └── fr
    │     │         ├── about.json
    │     │         │   
    │     │         ├── home.json
    │     │         │ 
    │     │         └── ...
    │     │  
    │     │
    │     ├── client.ts
    │     ├── locales.js
    │     ├── server.ts
    │     └── settings.ts
    │
    └── ...
```

- Fichiers json :

Le dossier "locales" contient les fichiers .json où vous définirez vos traductions, la convention étant de définir un fichier par page de votre site, avec le nom de la page concernée pour le nom du fichier json.
Il y a également un fichier "common" : si vous ne spécifiez pas de "namespace" ou ns (le nom du fichier sans l'extension json) dans vos pages ou composants, les traductions seront piochées dans ce fichier par défaut.

*Important : pour chaque langue, il doit y avoir un fichier correspondant avec le même nom, par exemple un fichier "about" pour "fr" et pour "en", etc. Ainsi que des clefs de traduction avec le même nom au sein
de chaque fichier. 

Exemple : 

En anglais dans le dossier "en":

```json:projects.json
{
  "title": "Projects",
  "description": "Showcase your projects with a hero image (16 x 9)",
  "learn": "Learn more",
  "subtitle": "Here you will find information about my current projects",
  "linkto": "Link to"
}
```

En français dans le dossier "fr":

```json:projects.json
{
  "title": "Projets",
  "description": "Présentez vos projets avec une image (16 x 9)",
  "learn": "En savoir plus",
  "subtitle": "Ici vous trouverez des informations sur mes projets actuels.",
  "linkto": "Lien vers"
}
```

- locales.js :

Il s'agit du fichier où vous définirez les langues que vous souhaitez utiliser, ainsi que la langue par défaut: 

```js:locales.js
const fallbackLng = 'en' // langue par défaut
const secondLng = 'fr' 

module.exports = { fallbackLng, secondLng }
```

Vous pouvez ajouter autant de langues que souhaité: 

```js:locales.js
// Exemple d'ajout d'une 3ème langue :
const fallbackLng = 'en'
const secondLng = 'fr'
const thirdLng = 'es'

module.exports = { fallbackLng, secondLng, thirdLng }
```

Toutefois, cela nécessitera quelques étapes de configuration supplémentaires au sein d'autres fichiers. Cette possibilité sera explorée dans un autre article.

- settings.ts

Il s'agit d'un fichier de configuration, qui permet de définir un objet locales ainsi que les options correspondantes :

```ts:settings.ts
import type { InitOptions } from 'i18next'
import { fallbackLng, secondLng } from './locales'

// Objet locales, qui définit toutes les langues qui seront utilisées dans l'application
export const locales = [fallbackLng, secondLng] as const
// Définition de type pour nos locales
export type LocaleTypes = (typeof locales)[number]
// "Namespace" (ou ns) par défaut : les traductions seront piochées dans le fichier 
// common.json si aucun ns n'est spécifié dans vos composants ou pages
export const defaultNS = 'common'
// Fonction qui sera réutilisée dans les fichiers client.ts et server.ts
export function getOptions(locale = fallbackLng, ns = defaultNS): InitOptions {
  return {
    debug: true,
    supportedLngs: locales,
    fallbackLng,
    lng: locale,
    fallbackNS: defaultNS,
    defaultNS,
    ns,
  }
}
```

- client.ts et server.ts :

Sans rentrer dans des détails complexes, ces deux fichiers exportent chacun
une fonction pour la traduction (useTranslation côté client, createTranslation côté serveur), 
réutilisables dans vos pages et composants :

```ts:client.ts
export function useTranslation(lng: LocaleTypes, ns: string) {
  const translator = useTransAlias(ns)
  const { i18n } = translator

  // Run when content is rendered on server side
  if (runsOnServerSide && lng && i18n.resolvedLanguage !== lng) {
    i18n.changeLanguage(lng)
  } else {
    // Use our custom implementation when running on client side
    // eslint-disable-next-line react-hooks/rules-of-hooks
    useCustomTranslationImplem(i18n, lng)
  }
  return translator
}
```

```ts:server.ts
export async function createTranslation(lang: LocaleTypes, ns: string) {
  const i18nextInstance = await initI18next(lang, ns)

  return {
    // This is the translation function we'll use in our components
    // e.g. t('greeting')
    t: i18nextInstance.getFixedT(lang, Array.isArray(ns) ? ns[0] : ns),
  }
}
```

Exemple de composant côté client, avec traduction de l'aria-label du bouton :

```ts:ThemeSwitch.tsx
'use client'

import { useEffect, useState } from 'react'
import { useTheme } from 'next-themes'
import { useParams } from 'next/navigation'
import { LocaleTypes } from 'app/[locale]/i18n/settings'
import { useTranslation } from 'app/[locale]/i18n/client'

const ThemeSwitch = () => {
  // Utilisation du hook fourni par next.js pour récupérer la langue actuellement définie 
  const locale = useParams()?.locale as LocaleTypes
  // Utilisation de la fonction de traduction côté client
  // Pas de ns défini (crochets vide), par conséquent la traduction sera piochée 
  // dans le fichier common.json
  const { t } = useTranslation(locale, '')
  const [mounted, setMounted] = useState(false)
  const { theme, setTheme, resolvedTheme } = useTheme()

  useEffect(() => setMounted(true), [])

  if (!mounted) {
    return null
  }

  return (
    <button
    // Traduction de l'aria-label
      aria-label={t('darkmode')}
      onClick={() => setTheme(theme === 'dark' || resolvedTheme === 'dark' ? 'light' : 'dark')}
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 20 20"
        fill="currentColor"
        className="h-6 w-6 text-gray-900 dark:text-gray-100"
      >
        {mounted && (theme === 'dark' || resolvedTheme === 'dark') ? (
          <path
            fillRule="evenodd"
            d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
            clipRule="evenodd"
          />
        ) : (
          <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
        )}
      </svg>
    </button>
  )
}

export default ThemeSwitch
```

Exemple de composant côté serveur :

```ts:footer.tsx
import Link from './Link'
import siteMetadata from '@/data/siteMetadata'
import SocialIcon from '@/components/social-icons'
import { createTranslation } from 'app/[locale]/i18n/server'
import { LocaleTypes } from 'app/[locale]/i18n/settings'

type Props = {
  params: { locale: LocaleTypes }
}
// la langue actuelle est passée en tant que prop des paramètres de la page
export default async function Footer({ params: { locale } }: Props) {
// Utilisation de la fonction de traduction côté serveur, avec le namespace "footer"
  const { t } = await createTranslation(locale, 'footer')
  return (
    <footer>
      <div className="mt-16 flex flex-col items-center">
        <div className="mb-3 flex space-x-4">
          <SocialIcon kind="mail" href={`mailto:${siteMetadata.email}`} size={6} />
          <SocialIcon kind="github" href={siteMetadata.github} size={6} />
          <SocialIcon kind="facebook" href={siteMetadata.facebook} size={6} />
          <SocialIcon kind="youtube" href={siteMetadata.youtube} size={6} />
          <SocialIcon kind="linkedin" href={siteMetadata.linkedin} size={6} />
          <SocialIcon kind="twitter" href={siteMetadata.twitter} size={6} />
        </div>
        <div className="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400">
          <div>{siteMetadata.author}</div>
          <div>{` • `}</div>
          <div>{`© ${new Date().getFullYear()}`}</div>
          <div>{` • `}</div>
          <Link href="/">{siteMetadata.title}</Link>
        </div>
        <div className="mb-8 text-sm text-gray-500 dark:text-gray-400">
          <Link href="https://github.com/timlrx/tailwind-nextjs-starter-blog">      
       {t('theme')}
          </Link>
        </div>
      </div>
    </footer>
  )
}
```

Pour la création de nouveaux composants ou pages, vous devrez donc vous appuyer sur ces deux 
fonctions concernant vos traductions.

- Middleware.ts :



## Articles

